import{a as Q,b as I}from"./chunk-ZYMZNC6O.js";import{a as W}from"./chunk-AJFPFQIJ.js";import{a as U,e as G}from"./chunk-22CXTBDP.js";import"./chunk-HRF36MJC.js";import{b as A,d as P,g as j,p as z}from"./chunk-OFSUVZPS.js";import{c as H}from"./chunk-WK7DSSTN.js";import"./chunk-BJIYRU5B.js";import{f as R}from"./chunk-2T54QLAV.js";import{$b as M,Ab as _,Ja as a,Ua as f,Xa as v,_a as D,a as B,aa as F,ac as q,db as n,dc as $,eb as t,ec as L,fb as N,ga as y,gb as V,hb as O,ib as b,jb as d,kb as c,mb as o,nb as u,ob as p,pa as x,pb as w,qa as g,qb as k,rb as E,sb as T,ub as C,zb as h}from"./chunk-UTOI2SA5.js";import"./chunk-FDERIQAA.js";function Y(s,i){if(s&1){let e=b();n(0,"div",22),d("click",function(){let m=x(e).$implicit,l=c(2);return g(l.selectCustomer(m))}),n(1,"div",23)(2,"span",24),o(3),t(),n(4,"span",25),o(5),t()()()}if(s&2){let e=i.$implicit;a(3),w("",e.name," ",e.lastName,""),a(2),p("ID: ",e.identityNumber,"")}}function Z(s,i){if(s&1&&(n(0,"div",20),f(1,Y,6,3,"div",21),t()),s&2){let e=c();a(),v("ngForOf",e.filteredCustomers)}}function ee(s,i){if(s&1){let e=b();V(0),n(1,"div",26)(2,"div",27)(3,"h2",28),o(4," \u{1F464} Customer Details "),t(),n(5,"button",29),d("click",function(){x(e);let m=c();return g(m.clearSelectedCustomer())}),o(6," \u274C Remove "),t()(),n(7,"div",30)(8,"p")(9,"strong"),o(10,"Name:"),t(),o(11),t(),n(12,"p")(13,"strong"),o(14,"ID:"),t(),o(15),t(),n(16,"p")(17,"strong"),o(18,"Phone:"),t(),o(19),t(),n(20,"p")(21,"strong"),o(22,"Address:"),t(),o(23),t(),n(24,"p")(25,"strong"),o(26,"Birth Date:"),t(),o(27),t(),n(28,"p")(29,"strong"),o(30,"Status:"),t(),o(31),t()()(),O()}if(s&2){let e=i.ngIf;a(11),w(" ",e.name," ",e.lastName,""),a(4),p(" ",e.identityNumber,""),a(4),p(" ",e.phone,""),a(4),p(" ",e.address||"Not specified",""),a(4),p(" ",e.dateOfBirth||"Not registered",""),a(4),p(" ",e.state||"No status","")}}function te(s,i){if(s&1){let e=b();n(0,"div",22),d("click",function(){let m=x(e).$implicit,l=c(2);return g(l.addBook(m))}),n(1,"div",23)(2,"span",24),o(3),t(),n(4,"span",25),o(5),t(),n(6,"span",32),o(7),t()()()}if(s&2){let e=i.$implicit;a(3),u(e.title),a(2),p("ISBN: ",e.isbn,""),a(2),u(e.category)}}function ie(s,i){if(s&1&&(n(0,"div",31),f(1,te,8,3,"div",21),t()),s&2){let e=c();a(),v("ngForOf",e.filteredBooks)}}function ne(s,i){s&1&&(n(0,"span",37),o(1,"Out of stock"),t())}function oe(s,i){if(s&1){let e=b();n(0,"div",38)(1,"button",40),d("click",function(){x(e);let m=c().$implicit,l=c();return g(l.decrementQuantity(m))}),o(2,"-"),t(),n(3,"span",41),o(4),t(),n(5,"button",42),d("click",function(){x(e);let m=c().$implicit,l=c();return g(l.incrementQuantity(m))}),o(6,"+"),t()()}if(s&2){let e=c().$implicit,r=c();a(),v("disabled",e.quantity<=1),a(3),u(e.quantity),a(),v("disabled",e.quantity>=r.getBookStock(e.id))}}function re(s,i){if(s&1){let e=b();n(0,"tr",33)(1,"td",34),o(2),t(),n(3,"td",35),o(4),t(),n(5,"td",36),o(6),h(7,"currency"),t(),n(8,"td",36),f(9,ne,2,0,"span",37)(10,oe,7,3,"div",38),t(),n(11,"td",35),o(12),h(13,"currency"),t(),n(14,"td",36)(15,"button",39),d("click",function(){let m=x(e).$implicit,l=c();return g(l.removeBook(m))}),o(16," Remove "),t()()()}if(s&2){let e=i.$implicit,r=c();a(2),u(e.isbn),a(2),u(e.bookName),a(2),u(_(7,5,e.priceUnit)),a(3),D(r.getBookStock(e.id)==0?9:10),a(3),p(" ",_(13,7,e.subtotal)," ")}}var S=class s{store=F(R);suscription=new B;searchCustomerText="";searchBookText="";filteredCustomers=[];filteredBooks=[];selectedCustomer=null;customers$=[];books$=[];invoice={id:0,numberInvoice:"",customer:new I,createdAt:new Date().toISOString(),iva:15,ivaTotal:0,subtotal:0,total:0,items:[]};ngOnInit(){this.loadCustomersAndBooks()}loadCustomersAndBooks(){let i=!1,e=!1,r=this.store.select(Q).subscribe(l=>{!i&&l.length===0&&(this.store.dispatch(W()),i=!0),this.customers$=l}),m=this.store.select(G).subscribe(l=>{!e&&l.length===0&&(this.store.dispatch(U()),e=!0),this.books$=l});this.suscription.add(r),this.suscription.add(m)}incrementQuantity(i){let e=this.getBookStock(i.id);i.quantity<e&&(i.quantity++,this.updateInvoiceTotals())}decrementQuantity(i){i.quantity>1&&(i.quantity--,this.updateInvoiceTotals())}getBookStock(i){return this.books$.find(r=>r.id===i)?.stock||0}onSearchCustomer(){let i=this.searchCustomerText.toLowerCase();this.filteredCustomers=this.customers$.filter(e=>e.identityNumber.includes(i)||`${e.name} ${e.lastName}`.toLowerCase().includes(i))}onSearchBook(){let i=this.searchBookText.toLowerCase();this.filteredBooks=this.books$.filter(e=>e.title.toLowerCase().includes(i)||e.isbn.includes(i)||e.category.toLowerCase().includes(i))}selectCustomer(i){this.searchCustomerText="",this.selectedCustomer=i,this.invoice.customer=i,this.filteredCustomers=[]}addBook(i){let e=this.invoice.items.find(r=>r.bookName===i.title);e?e.quantity+=1:this.invoice.items.push({isbn:i.isbn,id:i.id,bookName:i.title,priceUnit:i.price,quantity:1,subtotal:i.price}),this.updateInvoiceTotals(),this.filteredBooks=[],this.searchBookText=""}updateInvoiceTotals(){this.invoice.subtotal=this.invoice.items.reduce((i,e)=>(e.subtotal=e.priceUnit*e.quantity,i+e.subtotal),0),this.invoice.ivaTotal=this.invoice.subtotal*this.invoice.iva/100,this.invoice.total=this.invoice.subtotal+this.invoice.ivaTotal}removeBook(i){this.invoice.items=this.invoice.items.filter(e=>e.id!==i.id),this.updateInvoiceTotals()}clearSelectedCustomer(){this.selectedCustomer=null,this.invoice.customer=new I}resetInvoice(){this.invoice={id:0,numberInvoice:"",customer:new I,createdAt:new Date().toISOString(),iva:15,ivaTotal:0,subtotal:0,total:0,items:[]}}generateInvoice(){if(this.selectedCustomer===null){alert("Select a customer, please.");return}if(this.invoice.items.length===0){alert("Select at least one book, please.");return}let i={customerId:this.selectedCustomer.id,items:this.invoice.items.map(e=>({bookId:e.id,quantity:e.quantity}))};console.log("Factura para enviar:",i),this.store.dispatch(H({newItem:i})),this.resetInvoice(),this.clearSelectedCustomer()}ngOnDestroy(){this.suscription.unsubscribe()}static \u0275fac=function(e){return new(e||s)};static \u0275cmp=y({type:s,selectors:[["app-form-invoice"]],standalone:!0,features:[C],decls:57,vars:16,consts:[[1,"h-[calc(100vh-110px)]","w-full","overflow-y-scroll","grid","place-items-center"],[1,"p-10","w-[60%]","mx-auto","bg-white","rounded-xl","shadow-xl","border","border-gray-300"],[1,"text-4xl","font-extrabold","mb-8","text-gray-800","flex","items-center","gap-3"],[1,"mb-8","relative"],[1,"block","mb-2","font-semibold","text-gray-700"],["type","text","placeholder","Search by identity number or name",1,"w-full","p-3","rounded-md","border","border-gray-300","focus:outline-none","focus:ring-4","focus:ring-gray-500","focus:border-gray-600","transition",3,"ngModelChange","input","ngModel"],["class","absolute z-[100] w-full bg-white border border-gray-300 mt-1 max-h-44 overflow-y-auto rounded shadow-lg",4,"ngIf"],[4,"ngIf"],["type","text","placeholder","Search by title, ISBN or category",1,"w-full","p-3","rounded-md","border","border-gray-300","focus:outline-none","focus:ring-4","focus:ring-gray-500","focus:border-gray-600","transition",3,"ngModelChange","input","ngModel"],["class","absolute z-50 w-full bg-white border border-gray-300 mt-1 max-h-44 overflow-y-auto rounded shadow-lg",4,"ngIf"],[1,"relative","z-10","overflow-y-auto","mb-8","rounded","border","border-gray-300",2,"max-height","320px"],[1,"w-full","text-sm","text-gray-800"],[1,"bg-gray-700","text-white","sticky","top-0","z-10"],[1,"p-3","border","border-gray-600"],["class","hover:bg-gray-200 transition-colors",4,"ngFor","ngForOf"],[1,"mb-8","w-full","sm:w-1/2","md:w-1/3","ml-auto","bg-gray-100","p-6","rounded","shadow-inner","text-gray-900","font-semibold"],[1,"flex","justify-between","mb-2","text-lg"],[1,"flex","justify-between","text-xl","font-extrabold","border-t","border-gray-300","pt-3"],[1,"text-right"],[1,"bg-gray-700","hover:bg-gray-800","text-white","px-8","py-3","rounded","shadow","font-bold","transition-transform","active:scale-95",3,"click"],[1,"absolute","z-[100]","w-full","bg-white","border","border-gray-300","mt-1","max-h-44","overflow-y-auto","rounded","shadow-lg"],["class","cursor-pointer hover:bg-gray-200 p-3 text-sm text-gray-900 font-medium border-b border-gray-100",3,"click",4,"ngFor","ngForOf"],[1,"cursor-pointer","hover:bg-gray-200","p-3","text-sm","text-gray-900","font-medium","border-b","border-gray-100",3,"click"],[1,"flex","flex-col"],[1,"text-gray-800","font-semibold"],[1,"text-xs","text-gray-500"],[1,"mb-8","border","border-gray-300","bg-gray-100","p-5","rounded","shadow-inner","text-gray-900"],[1,"flex","justify-between","items-center","mb-4"],[1,"text-xl","font-semibold","flex","items-center","gap-2"],[1,"text-red-600","hover:underline","text-sm","font-semibold",3,"click"],[1,"grid","grid-cols-1","sm:grid-cols-2","gap-6","text-sm","leading-relaxed"],[1,"absolute","z-50","w-full","bg-white","border","border-gray-300","mt-1","max-h-44","overflow-y-auto","rounded","shadow-lg"],[1,"text-xs","text-indigo-600","font-medium"],[1,"hover:bg-gray-200","transition-colors"],[1,"p-3","border","border-gray-300","font-mono"],[1,"p-3","border","border-gray-300","font-semibold"],[1,"p-3","border","border-gray-300"],[1,"text-red-600","font-semibold"],[1,"flex","items-center","justify-center","gap-2"],[1,"text-red-600","hover:underline","font-semibold",3,"click"],[1,"px-3","py-1","border","rounded","bg-red-400","hover:bg-red-300","cursor-pointer",3,"click","disabled"],[1,"font-semibold"],[1,"px-2.5","py-1","border","rounded","bg-blue-400","hover:bg-blue-300",3,"click","disabled"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"h1",2),o(3," \u{1F4C4} "),n(4,"span"),o(5,"Register Invoice"),t()(),n(6,"div",3)(7,"label",4),o(8,"Customer"),t(),n(9,"input",5),T("ngModelChange",function(l){return E(r.searchCustomerText,l)||(r.searchCustomerText=l),l}),d("input",function(){return r.onSearchCustomer()}),t(),f(10,Z,2,1,"div",6),t(),f(11,ee,32,7,"ng-container",7),n(12,"div",3)(13,"label",4),o(14,"Book"),t(),n(15,"input",8),T("ngModelChange",function(l){return E(r.searchBookText,l)||(r.searchBookText=l),l}),d("input",function(){return r.onSearchBook()}),t(),f(16,ie,2,1,"div",9),t(),n(17,"div",10)(18,"table",11)(19,"thead",12)(20,"tr")(21,"th",13),o(22,"ISBN"),t(),n(23,"th",13),o(24,"Title"),t(),n(25,"th",13),o(26,"Price"),t(),n(27,"th",13),o(28,"Quantity"),t(),n(29,"th",13),o(30,"Subtotal"),t(),n(31,"th",13),o(32,"Action"),t()()(),n(33,"tbody"),f(34,re,17,9,"tr",14),t()()(),n(35,"div",15)(36,"p",16)(37,"span"),o(38,"Subtotal:"),t(),n(39,"span"),o(40),h(41,"currency"),t()(),n(42,"p",16)(43,"span"),o(44),t(),n(45,"span"),o(46),h(47,"currency"),t()(),n(48,"p",17)(49,"span"),o(50,"Total:"),t(),n(51,"span"),o(52),h(53,"currency"),t()()(),n(54,"div",18)(55,"button",19),d("click",function(){return r.generateInvoice()}),o(56," \u{1F4BE} Generate Invoice "),t()()()()),e&2&&(a(9),k("ngModel",r.searchCustomerText),a(),v("ngIf",r.searchCustomerText&&r.filteredCustomers.length&&!r.selectedCustomer),a(),v("ngIf",r.selectedCustomer),a(4),k("ngModel",r.searchBookText),a(),v("ngIf",r.searchBookText&&r.filteredBooks.length),a(18),v("ngForOf",r.invoice.items),a(6),u(_(41,10,r.invoice.subtotal)),a(4),p("VAT (",r.invoice.iva,"%):"),a(2),u(_(47,12,r.invoice.ivaTotal)),a(6),u(_(53,14,r.invoice.total)))},dependencies:[L,M,q,$,z,A,P,j]})};var J=class s{static \u0275fac=function(e){return new(e||s)};static \u0275cmp=y({type:s,selectors:[["app-invoice"]],standalone:!0,features:[C],decls:2,vars:0,consts:[[1,"px-6","h-full","flex","flex-col"]],template:function(e,r){e&1&&(n(0,"div",0),N(1,"app-form-invoice"),t())},dependencies:[S]})};export{J as InvoiceComponent};
