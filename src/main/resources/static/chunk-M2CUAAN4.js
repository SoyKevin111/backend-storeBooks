import"./chunk-QIG3T3FB.js";import{a as le}from"./chunk-SORMBLYZ.js";import{a as ne}from"./chunk-WEM5JORN.js";import{a as me}from"./chunk-YERVY55Z.js";import{a as ae}from"./chunk-NMZI5THH.js";import{a as ie}from"./chunk-46J4RIDY.js";import{a as M,b as re}from"./chunk-O22OUVCV.js";import{a as ge}from"./chunk-YGPISVLE.js";import{a as de,b as se,c as ue,d as ce,e as pe}from"./chunk-22CXTBDP.js";import"./chunk-HRF36MJC.js";import{a as G,b as H,c as p,d as W,e as K,f as $,h as J,i as Q,j as U,k as X,l as Z,m as ee,o as te,q as oe}from"./chunk-OFSUVZPS.js";import{a as z}from"./chunk-S4B3EVCZ.js";import"./chunk-BJIYRU5B.js";import{f as V}from"./chunk-2T54QLAV.js";import{$a as A,Ja as m,Ua as u,Xa as s,_b as L,a as B,aa as b,ac as Y,bb as N,cb as O,db as l,eb as r,ec as j,fb as y,ga as w,ib as q,jb as f,kb as c,mb as d,ob as x,pa as T,qa as I,ub as D}from"./chunk-UTOI2SA5.js";import{a as R,b as P,d as be}from"./chunk-FDERIQAA.js";var fe=be(ge());function ke(i,o){i&1&&(l(0,"div"),d(1,"Title is required."),r())}function ye(i,o){i&1&&(l(0,"div"),d(1,"Max 30 characters."),r())}function xe(i,o){i&1&&(l(0,"div"),d(1,"Title cannot be blank."),r())}function Ce(i,o){if(i&1&&(l(0,"div",31),u(1,ke,2,0,"div",32)(2,ye,2,0,"div",32)(3,xe,2,0,"div",32),r()),i&2){let t,e,n,a=c();m(),s("ngIf",(t=a.bookForm.get("title"))==null||t.errors==null?null:t.errors.required),m(),s("ngIf",(e=a.bookForm.get("title"))==null||e.errors==null?null:e.errors.maxlength),m(),s("ngIf",(n=a.bookForm.get("title"))==null||n.errors==null?null:n.errors.pattern)}}function Fe(i,o){if(i&1){let t=q();l(0,"div",33),f("click",function(){let n=T(t).$implicit,a=c();return I(a.toggleSelect("category",n))}),d(1),r()}if(i&2){let t=o.$implicit;m(),x(" ",t," ")}}function Se(i,o){i&1&&(l(0,"div"),d(1,"Category is required."),r())}function Ee(i,o){i&1&&(l(0,"div"),d(1,"Max 10 characters."),r())}function Be(i,o){if(i&1&&(l(0,"div",31),u(1,Se,2,0,"div",32)(2,Ee,2,0,"div",32),r()),i&2){let t,e,n=c();m(),s("ngIf",(t=n.bookForm.get("category"))==null||t.errors==null?null:t.errors.required),m(),s("ngIf",(e=n.bookForm.get("category"))==null||e.errors==null?null:e.errors.maxlength)}}function we(i,o){i&1&&(l(0,"div"),d(1,"Description is required."),r())}function Te(i,o){i&1&&(l(0,"div"),d(1,"Max 100 characters allowed."),r())}function Ie(i,o){i&1&&(l(0,"div"),d(1,"Description cannot be blank."),r())}function Ae(i,o){if(i&1&&(l(0,"div",31),u(1,we,2,0,"div",32)(2,Te,2,0,"div",32)(3,Ie,2,0,"div",32),r()),i&2){let t,e,n,a=c();m(),s("ngIf",(t=a.bookForm.get("description"))==null||t.errors==null?null:t.errors.required),m(),s("ngIf",(e=a.bookForm.get("description"))==null||e.errors==null?null:e.errors.maxlength),m(),s("ngIf",(n=a.bookForm.get("description"))==null||n.errors==null?null:n.errors.pattern)}}function Ne(i,o){i&1&&(l(0,"div"),d(1,"Price is required."),r())}function Oe(i,o){i&1&&(l(0,"div"),d(1,"Price must be at least 1."),r())}function qe(i,o){if(i&1&&(l(0,"div",31),u(1,Ne,2,0,"div",32)(2,Oe,2,0,"div",32),r()),i&2){let t,e,n=c();m(),s("ngIf",(t=n.bookForm.get("price"))==null||t.errors==null?null:t.errors.required),m(),s("ngIf",(e=n.bookForm.get("price"))==null||e.errors==null?null:e.errors.min)}}function De(i,o){i&1&&(l(0,"div"),d(1,"Stock is required."),r())}function Me(i,o){i&1&&(l(0,"div"),d(1,"Stock must be at least 1."),r())}function Ve(i,o){if(i&1&&(l(0,"div",31),u(1,De,2,0,"div",32)(2,Me,2,0,"div",32),r()),i&2){let t,e,n=c();m(),s("ngIf",(t=n.bookForm.get("stock"))==null||t.errors==null?null:t.errors.required),m(),s("ngIf",(e=n.bookForm.get("stock"))==null||e.errors==null?null:e.errors.min)}}function $e(i,o){i&1&&(l(0,"div"),d(1,"Publication date is required."),r())}function Re(i,o){if(i&1&&(l(0,"div",31),u(1,$e,2,0,"div",32),r()),i&2){let t,e=c();m(),s("ngIf",(t=e.bookForm.get("dateCreated"))==null||t.errors==null?null:t.errors.required)}}function Pe(i,o){if(i&1){let t=q();l(0,"div",34),f("click",function(){let n=T(t).$implicit,a=c();return I(a.toggleSelect("editorial",n.name,n.id))}),d(1),r()}if(i&2){let t=o.$implicit;m(),x(" ",t.name," ")}}function Le(i,o){i&1&&(l(0,"div"),d(1,"Editorial is required."),r())}function Ye(i,o){if(i&1&&(l(0,"div",31),u(1,Le,2,0,"div",32),r()),i&2){let t,e=c();m(),s("ngIf",(t=e.bookForm.get("editorial"))==null||t.errors==null?null:t.errors.required)}}function je(i,o){if(i&1){let t=q();l(0,"div",26)(1,"input",35),f("change",function(n){let a=T(t).$implicit,_=c();return I(_.onAuthorChange(n,a))}),r(),l(2,"label",36),d(3),r()()}if(i&2){let t=o.$implicit,e=c();m(),s("id","author-"+t.id)("checked",e.isAuthorSelected(t)),m(),s("for","author-"+t.id),m(),x(" ",t.name,"")}}function ze(i,o){i&1&&(l(0,"div"),d(1,"At least one author is required."),r())}function Ge(i,o){i&1&&(l(0,"div"),d(1,"You can select up to 3 authors only."),r())}function He(i,o){if(i&1&&(l(0,"div",31),u(1,ze,2,0,"div",32)(2,Ge,2,0,"div",32),r()),i&2){let t,e,n=c();m(),s("ngIf",(t=n.bookForm.get("authors"))==null||t.errors==null?null:t.errors.required),m(),s("ngIf",(e=n.bookForm.get("authors"))==null||e.errors==null?null:e.errors.maxAuthors)}}var C=class i{modalService=b(M);fb=b(te);functionTyeEm="";book;store=b(V);suscription=new B;editorialId=null;animationState="modal-animate-in";authorOptions$=[];editorialOptions$=[];categoryOptions=["FICTION","HISTORY","FANTASY","BIOGRAPHY","MYSTERY","ROMANCE","THRILLER","HEALTH","ANIME"];dropdownState={editorial:!1,category:!1,authors:!1};bookForm=this.fb.group({title:["",[p.required,p.maxLength(30),p.pattern(/^(?!\s*$).+/)]],editorial:[""],dateCreated:["",p.required],description:["",p.required],price:[0,[p.required,p.min(1)]],stock:[0,[p.required,p.min(1)]],category:["",[p.required,p.maxLength(20)]],authors:this.fb.array([],[p.required]),bestSeller:[!1]});ngOnInit(){if(this.loadAuthorsAndEditorials(),!this.book)return;let{title:o,editorial:t,description:e,dateCreated:n,price:a,stock:_,category:v,bestSeller:h,authors:k}=this.book;this.bookForm.patchValue({title:o,editorial:t.name,description:e,dateCreated:n,price:a,stock:_,category:v,bestSeller:h});let g=this.bookForm.get("authors");g.clear(),k.forEach(F=>{g.push(new $(F))}),console.log(this.bookForm.value)}loadAuthorsAndEditorials(){let o=!1,t=!1,e=this.store.select(le).subscribe(a=>{!o&&a.length===0&&(this.store.dispatch(ne()),o=!0),this.authorOptions$=a}),n=this.store.select(me).subscribe(a=>{!t&&a.length===0&&(this.store.dispatch(ae()),t=!0),this.editorialOptions$=a});this.suscription.add(e),this.suscription.add(n)}toggleDropdown(o){this.dropdownState[o]=!this.dropdownState[o]}toggleSelect(o,t,e){this.bookForm.get(o)?.setValue(t),this.dropdownState[o]=!1,e&&(this.editorialId=e)}close(){this.animationState="modal-animate-out",setTimeout(()=>this.modalService.close(),150)}onAuthorChange(o,t){let e=this.bookForm.get("authors");if(o.target.checked){if(e.length>=3){o.target.checked=!1,fe.default.fire({icon:"error",title:"Error",text:"You can select up to 3 authors only.",confirmButtonColor:"#3085d6"});return}e.push(new $(t))}else{let n=e.controls.findIndex(a=>a.value.id===t.id);n!==-1&&e.removeAt(n)}}isAuthorSelected(o){return this.bookForm.get("authors").value.some(e=>e.id===o.id)}onSubmit(){if(this.bookForm.valid)this.save(),this.close();else{this.bookForm.markAllAsTouched();for(let[o,t]of Object.entries(this.bookForm.controls))t.errors&&console.log(`Errores en ${o}:`,t.errors)}}save(){function o(a){return a==null||typeof a=="string"&&a.trim()===""||Array.isArray(a)&&a.length===0?null:a}let t=this.bookForm.get("authors")?.value,e=Array.isArray(t)?t.map(a=>Number(a.id)).filter(a=>!isNaN(a)):null,n={id:this.book?Number(this.book.id):0,isbn:o(this.bookForm.get("isbn")?.value),title:o(this.bookForm.get("title")?.value),editorialId:this.book?Number(this.book.editorial.id):Number(this.editorialId),dateCreated:o(this.bookForm.get("dateCreated")?.value),description:o(this.bookForm.get("description")?.value),price:o(this.bookForm.get("price")?.value),stock:o(this.bookForm.get("stock")?.value),category:o(this.bookForm.get("category")?.value),bestSeller:o(this.bookForm.get("bestSeller")?.value),authorsId:o(e)};console.log(n),this.book?this.store.dispatch(ue({editedItem:n})):this.store.dispatch(se({newItem:n}))}ngOnDestroy(){this.suscription.unsubscribe()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["app-form-book"]],inputs:{functionTyeEm:"functionTyeEm",book:"book"},standalone:!0,features:[D],decls:71,vars:16,consts:[[1,"fixed","inset-0","bg-black","bg-opacity-60","z-40","flex","items-center","justify-center"],[1,"w-full","max-w-4xl","bg-white","rounded-xl","shadow-lg","mx-4","md:mx-0",3,"ngClass"],[1,"py-8","text-center","font-bold","text-2xl","text-gray-800"],[1,"px-8","pb-8","space-y-6",3,"ngSubmit","formGroup"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],["for","title",1,"block","mb-2","text-sm","font-medium","text-gray-900"],["type","text","id","title","formControlName","title","placeholder","Enter book title",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","shadow-sm","focus:ring-blue-500","focus:border-blue-500"],["class","text-red-500 text-sm mt-1",4,"ngIf"],[1,"relative"],[1,"block","mb-2","text-sm","font-medium","text-gray-900"],["type","button",1,"w-full","border","border-gray-300","rounded","px-4","py-2","text-left","bg-white","shadow-sm","hover:bg-gray-50",3,"click"],[1,"float-right"],[1,"absolute","z-10","w-full","mt-1","bg-white","border","border-gray-300","rounded","shadow-md","max-h-60","overflow-y-auto",3,"ngClass"],[1,"px-4","py-2","hover:bg-gray-100","cursor-pointer"],[1,"md:col-span-2"],["for","description",1,"block","mb-2","text-sm","font-medium","text-gray-900"],["id","description","formControlName","description","rows","3","maxlength","100","placeholder","Enter a short description (max 100 characters)",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","shadow-sm","focus:ring-blue-500","focus:border-blue-500","resize-none"],["for","price",1,"block","mb-2","text-sm","font-medium","text-gray-900"],["type","number","step","0.01","min","1","id","price","formControlName","price","placeholder","0.00",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","shadow-sm","focus:ring-blue-500","focus:border-blue-500","no-spinner"],["for","stock",1,"block","mb-2","text-sm","font-medium","text-gray-900"],["type","number","min","1","id","stock","formControlName","stock",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","shadow-sm","focus:ring-blue-500","focus:border-blue-500","no-spinner"],["for","publication_date",1,"block","mb-2","text-sm","font-medium","text-gray-900"],["type","date","id","publication_date","formControlName","dateCreated",1,"w-full","border","border-gray-300","rounded-lg","px-3","py-2","shadow-sm","focus:ring-blue-500","focus:border-blue-500"],[1,"absolute","z-10","w-full","mt-1","bg-white","border","border-gray-300","rounded","shadow-md","max-h-28","overflow-y-auto",3,"ngClass"],[1,"flex","items-center","px-4","py-2","hover:bg-gray-100","cursor-pointer"],[1,"relative","md:col-span-2"],[1,"flex","items-center","px-4","py-2","hover:bg-gray-100"],[1,"flex","items-center","space-x-2"],["type","checkbox","formControlName","bestSeller",1,"w-4","h-4","text-blue-600","border-gray-300","rounded","focus:ring-blue-500"],[1,"text-sm","font-medium","text-gray-900"],[3,"closeModal","functionTyeRec"],[1,"text-red-500","text-sm","mt-1"],[4,"ngIf"],[1,"px-4","py-2","hover:bg-gray-100","cursor-pointer",3,"click"],[1,"flex","items-center","px-4","py-2","hover:bg-gray-100","cursor-pointer",3,"click"],["type","checkbox",1,"mr-2",3,"change","id","checked"],[3,"for"]],template:function(t,e){if(t&1&&(l(0,"div",0)(1,"div",1)(2,"h1",2),d(3,"BOOK FORM"),r(),l(4,"form",3),f("ngSubmit",function(){return e.onSubmit()}),l(5,"div",4)(6,"div")(7,"label",5),d(8,"Title"),r(),y(9,"input",6),u(10,Ce,4,3,"div",7),r(),l(11,"div",8)(12,"label",9),d(13,"Category"),r(),l(14,"button",10),f("click",function(){return e.toggleDropdown("category")}),d(15),l(16,"span",11),d(17,"\u25BC"),r()(),l(18,"div",12),N(19,Fe,2,1,"div",13,A),r(),u(21,Be,3,2,"div",7),r(),l(22,"div",14)(23,"label",15),d(24,"Description"),r(),l(25,"textarea",16),d(26,"          "),r(),u(27,Ae,4,3,"div",7),r(),l(28,"div")(29,"label",17),d(30,"Price"),r(),y(31,"input",18),u(32,qe,3,2,"div",7),r(),l(33,"div")(34,"label",19),d(35,"Stock"),r(),y(36,"input",20),u(37,Ve,3,2,"div",7),r(),l(38,"div")(39,"label",21),d(40,"Publication Date"),r(),y(41,"input",22),u(42,Re,2,1,"div",7),r(),l(43,"div",8)(44,"label",9),d(45,"Editorials"),r(),l(46,"button",10),f("click",function(){return e.toggleDropdown("editorial")}),d(47),l(48,"span",11),d(49,"\u25BC"),r()(),l(50,"div",23),N(51,Pe,2,1,"div",24,A),r(),u(53,Ye,2,1,"div",7),r(),l(54,"div",25)(55,"label",9),d(56,"Authors"),r(),l(57,"button",10),f("click",function(){return e.toggleDropdown("authors")}),d(58," Choose authors "),l(59,"span",11),d(60,"\u25BC"),r()(),l(61,"div",23),N(62,je,4,4,"div",26,A),r(),u(64,He,3,2,"div",7),r()(),l(65,"div")(66,"label",27),y(67,"input",28),l(68,"span",29),d(69,"Mark as Best Seller"),r()()(),l(70,"app-cancel-save-buttons",30),f("closeModal",function(){return e.close()}),r()()()()),t&2){let n,a,_,v,h,k,g,F,S,E;m(),s("ngClass",e.animationState),m(3),s("formGroup",e.bookForm),m(6),s("ngIf",((n=e.bookForm.get("title"))==null?null:n.touched)&&((n=e.bookForm.get("title"))==null?null:n.invalid)),m(5),x(" ",((a=e.bookForm.get("category"))==null?null:a.value)||"Choose category"," "),m(3),s("ngClass",e.dropdownState.category?"block":"hidden"),m(),O(e.categoryOptions),m(2),s("ngIf",((_=e.bookForm.get("category"))==null?null:_.touched)&&((_=e.bookForm.get("category"))==null?null:_.invalid)),m(6),s("ngIf",((v=e.bookForm.get("description"))==null?null:v.touched)&&((v=e.bookForm.get("description"))==null?null:v.invalid)),m(5),s("ngIf",((h=e.bookForm.get("price"))==null?null:h.touched)&&((h=e.bookForm.get("price"))==null?null:h.invalid)),m(5),s("ngIf",((k=e.bookForm.get("stock"))==null?null:k.touched)&&((k=e.bookForm.get("stock"))==null?null:k.invalid)),m(5),s("ngIf",((g=e.bookForm.get("dateCreated"))==null?null:g.touched)&&((g=e.bookForm.get("dateCreated"))==null?null:g.invalid)),m(5),x(" ",((F=e.bookForm.get("editorial"))==null?null:F.value)||"Choose editorials"," "),m(3),s("ngClass",e.dropdownState.editorial?"block":"hidden"),m(),O(e.editorialOptions$),m(2),s("ngIf",((S=e.bookForm.get("editorial"))==null?null:S.touched)&&((S=e.bookForm.get("editorial"))==null?null:S.invalid)),m(8),s("ngClass",e.dropdownState.authors?"block":"hidden"),m(),O(e.authorOptions$),m(2),s("ngIf",((E=e.bookForm.get("authors"))==null?null:E.touched)&&((E=e.bookForm.get("authors"))==null?null:E.invalid)),m(6),s("functionTyeRec",e.functionTyeEm)}},dependencies:[j,L,Y,oe,J,H,Q,G,W,K,ee,Z,U,X,ie],styles:[".toggleSelector[_ngcontent-%COMP%]{display:block}"]})};var _e=class i{modalService=b(M);notificationService=b(re);store=b(V);subscription=new B;booksWithExtras$=[];columns=[{field:"isbn",header:"ISBN"},{field:"title",header:"Title"},{field:"category",header:"Category"},{field:"editorialName",header:"Editorial"},{field:"authorsNames",header:"Authors"},{field:"dateCreated",header:"Publication Date"},{field:"price",header:"Price"},{field:"stock",header:"Stock"}];ngOnInit(){let o=!1,t=this.store.select(pe).subscribe(e=>{!o&&e.length===0&&(this.store.dispatch(de()),o=!0),this.booksWithExtras$=e.map(n=>P(R({},n),{editorialName:n.editorial?.name||"",authorsNames:(n.authors??[]).map(a=>a.name).join(", ")}))});this.subscription.add(t)}createBook(){console.log("Create book clicked"),this.modalService.open(C,{functionTyeEm:"create"})}editBook(o){console.log("Edit:",o),this.modalService.open(C,{functionTyeEm:"update",book:o})}deleteBook(o){this.notificationService.showConfirmationDelete("Book",()=>{this.store.dispatch(ce({id:o.id}))}),console.log("Delete:",o)}viewBook(o){console.log("View:",o)}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=w({type:i,selectors:[["app-books"]],standalone:!0,features:[D],decls:5,vars:2,consts:[[1,"px-6","h-full"],[1,"text-2xl","font-extrabold","text-gray-800","flex","items-center","gap-3"],[1,"table-books"],["type","no-view",3,"create","edit","delete","view","columns","data"]],template:function(t,e){t&1&&(l(0,"div",0)(1,"h1",1),d(2," Books "),r(),l(3,"div",2)(4,"app-crud-table",3),f("create",function(){return e.createBook()})("edit",function(a){return e.editBook(a)})("delete",function(a){return e.deleteBook(a)})("view",function(a){return e.viewBook(a)}),r()()()),t&2&&(m(4),s("columns",e.columns)("data",e.booksWithExtras$))},dependencies:[z]})};export{_e as BooksComponent};
